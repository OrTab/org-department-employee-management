import{o as I,d as M,u as A,r as o,j as l,S as u}from"./index-C78JEomy.js";import{s as r,M as g,F as O,B as T}from"./Table-B1XpehUF.js";const N=I(()=>{const{rootStore:{companyStore:{selectedCompany:c,selectedCompanyId:s}},rootController:{companyController:a}}=A(),{departments:y}=c,[t,h]=o.useState(null),[i,f]=o.useState(null),[m,D]=o.useState(null),[k,n]=o.useState(!1),x=o.useCallback(async e=>{try{n(!0),await a.deleteDepartment(e,s),r.success("Department deleted successfully!")}catch{r.error("Failed to delete department!")}finally{n(!1)}},[a,s]),p=o.useCallback(()=>{h(null),f(null),D(null)},[]),d=o.useCallback(e=>{g.confirm({title:"Are you sure you want to delete this department?",content:`Department: ${c.departmentsById[e].name}`,onOk:()=>x(e),onCancel:p})},[x,p,c.departmentsById]),S=o.useCallback(async()=>{if(t)try{n(!0),await a.deleteDepartmentEmployees(t,s),r.success("Employees deleted successfully!"),d(t)}catch{r.error("Failed to delete employees!")}finally{n(!1)}},[a,s,t,d]),E=o.useCallback(async()=>{if(!(!t||!m))try{n(!0),await a.moveEmployeesToDepartment(t,m,s),r.success("Employees moved successfully!"),d(t)}catch{r.error("Failed to move employees!")}finally{n(!1)}},[a,s,t,d,m]),j=()=>{i==="delete"?S():i==="move"&&m&&E()},b=e=>{c.departmentsById[e].employees.length>0?h(e):d(e)},F=y.map(e=>({key:e.id,name:e.name,employees:e.employees.length})),w=[{title:"Department",dataIndex:"name",key:"name",fixed:"left"},{title:"Employees Number",dataIndex:"employees",key:"employees"},{title:"Actions",key:"delete",render:(e,{key:C})=>l.jsx(T,{type:"primary",danger:!0,onClick:()=>b(C),children:"Delete"})}],B=t?c.departmentsById[t]:void 0;return l.jsxs(l.Fragment,{children:[l.jsx(O,{scroll:{x:"max-content"},columns:w,dataSource:F,pagination:!1}),l.jsxs(g,{title:"Manage Employees Before Deleting Department",open:!!B,onOk:j,onCancel:p,confirmLoading:k,children:[l.jsx("p",{children:"This department has employees. What would you like to do?"}),l.jsxs(v,{placeholder:"Select action for employees",value:i,onChange:e=>f(e),children:[l.jsx(u.Option,{value:"delete",children:"Delete all employees"}),l.jsx(u.Option,{value:"move",children:"Move employees to another department"})]}),i==="move"&&l.jsx(v,{placeholder:"Select target department",value:m,onChange:e=>D(e),options:y.filter(e=>e.id!==t).map(e=>({value:e.id,label:e.name}))})]})]})}),v=M(u)`
  && {
    width: 100%;
  }
`;export{N as default};
