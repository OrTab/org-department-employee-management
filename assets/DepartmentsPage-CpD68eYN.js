import{u as b,r as n,d as F,j as a,S as g,o as A}from"./index-CNt3VhN-.js";import{s as f,M as E,F as w,B}from"./Table-CJYYUnS4.js";const I=()=>{const{rootStore:{companyStore:{selectedCompany:s,selectedCompanyId:o}},rootController:{companyController:l}}=b(),{departments:D}=s,[e,u]=n.useState(null),[c,y]=n.useState(null),[r,h]=n.useState(null),[t,m]=n.useState(!1),C=n.useCallback(async i=>{try{m(!0),await l.deleteDepartment(i,o),f.success("Department deleted successfully!")}catch{f.error("Failed to delete department!")}finally{m(!1)}},[l,o]),d=n.useCallback(()=>{u(null),y(null),h(null)},[]),p=n.useCallback(i=>{E.confirm({title:"Are you sure you want to delete this department?",content:`Department: ${s.departmentsById[i].name}`,onOk:()=>C(i),onCancel:d})},[C,d,s.departmentsById]),x=n.useCallback(async()=>{if(e)try{m(!0),await l.deleteDepartmentEmployees(e,o),f.success("Employees deleted successfully!"),p(e)}catch{f.error("Failed to delete employees!")}finally{m(!1)}},[l,o,e,p]),k=n.useCallback(async()=>{if(!(!e||!r))try{m(!0),await l.moveEmployeesToDepartment(e,r,o),f.success("Employees moved successfully!"),p(e)}catch{f.error("Failed to move employees!")}finally{m(!1)}},[l,o,e,p,r]),S=n.useCallback(()=>{c==="delete"?x():c==="move"&&r&&k()},[c,x,k,r]),j=n.useCallback(i=>{s.departmentsById[i].employees.length>0?u(i):p(i)},[s.departmentsById,p]);return{selectedDepartment:e?s.departmentsById[e]:void 0,loading:t,handleDeleteClick:j,onConfirmAction:S,handleClose:d,selectedDepartmentId:e,actionForEmployees:c,targetDepartment:r,departments:D,setActionForEmployees:y,setTargetDepartment:h}},M=({isOpen:s,loading:o,actionForEmployees:l,targetDepartment:D,departments:e,selectedDepartmentId:u,onActionChange:c,onTargetDepartmentChange:y,onOk:r,onCancel:h})=>a.jsxs(E,{title:"Manage Employees Before Deleting Department",open:s,onOk:r,onCancel:h,confirmLoading:o,children:[a.jsx("p",{children:"This department has employees. What would you like to do?"}),a.jsxs(v,{placeholder:"Select action for employees",value:l,onChange:t=>c(t),children:[a.jsx(g.Option,{value:"delete",children:"Delete all employees"}),a.jsx(g.Option,{value:"move",children:"Move employees to another department"})]}),l==="move"&&a.jsx(v,{placeholder:"Select target department",value:D,onChange:t=>y(t),options:e.filter(t=>t.id!==u).map(t=>({value:t.id,label:t.name}))})]}),v=F(g)`
  && {
    width: 100%;
  }
`,W=A(()=>{const{selectedDepartmentId:s,selectedDepartment:o,loading:l,handleDeleteClick:D,onConfirmAction:e,handleClose:u,departments:c,actionForEmployees:y,setActionForEmployees:r,setTargetDepartment:h,targetDepartment:t}=I(),m=c.map(d=>({key:d.id,name:d.name,employees:d.employees.length})),C=[{title:"Department",dataIndex:"name",key:"name",fixed:"left"},{title:"Employees Number",dataIndex:"employees",key:"employees"},{title:"Actions",key:"delete",render:(d,{key:p})=>a.jsx(B,{type:"primary",danger:!0,onClick:()=>D(p),children:"Delete"})}];return a.jsxs(a.Fragment,{children:[a.jsx(w,{scroll:{x:"max-content"},columns:C,dataSource:m,pagination:!1}),a.jsx(M,{isOpen:!!o,loading:l,actionForEmployees:y,targetDepartment:t,departments:c,selectedDepartmentId:s,onActionChange:r,onTargetDepartmentChange:h,onOk:e,onCancel:u})]})});export{W as default};
